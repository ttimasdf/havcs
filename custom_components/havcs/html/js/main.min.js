var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");
var BaseInput=Vue.extend({template:"#base-input",props:{defaultValue:{type:Object,default:function(){return{id:"",value:"",isLastItem:!0}}},label:{type:String}},data:function(){return{value:"",id:"",isLastItem:""}},created:function(){this.value=this.defaultValue.value;this.id=this.defaultValue.id;this.isLastItem=this.defaultValue.isLastItem},methods:{change:function(a){this.value=a.target.value;this.$emit("change",this.id,a.target.value)},deleteItem:function(){this.$emit("delete-item")},addItem:function(a){""!==
this.value&&(this.$emit("add-item"),this.isLastItem=!1,$(a.target).parent().prev().find("input").attr("disabled",!0))}}}),MultiInput=Vue.extend({template:"#multi-input",components:{"base-input":BaseInput},props:["label","data"],data:function(){return{items:[],nextId:1}},created:function(){if(0<this.data.length)for(i in this.items=[],this.nextId=1,this.data)this.items.push({id:this.nextId++,value:JSON.stringify(this.data[i])});this.items.push({id:this.nextId++,value:""})},methods:{inputChange:function(a,
b,c){this.items[c].value=b;this.$emit("update-action",this.items.slice(0,this.items.length-1),this.label)},addItem:function(){this.items.push({id:this.nextId++,value:""});this.$emit("update-action",this.items.slice(0,this.items.length-1),this.label)},deleteItem:function(a){this.items.splice(a,1);this.$emit("update-action",this.items.slice(0,this.items.length-1),this.label)}}}),ComponentList=Vue.extend({template:"#list",inject:["reload"],props:["notice","deviceList"],created:function(){},methods:{addOrEdit:function(a){"undefined"==
typeof a||null==a||""==a?this.$router.push({name:"add",params:{device_id:""}}):this.$router.push({name:"edit",params:{device_id:a}})},exportDevices:function(){ha.file({action:"export"})},importDevices:function(){$("#fileUpload").trigger("click")},upload:function(a){var b=this,c=new FormData;c.append("action","import");c.append("file",a.target.files[0]);ha.post(c).then(function(a){"ok"==a.code?(b.reload(),$.toast(a.Msg,"info")):$.toptip(a.Msg,3E3,"error")});a.target.value=""},syncDevices:function(){var a=
this;ha.post({action:"sync"}).then(function(b){"ok"==b.code?(a.reload(),$.toast(b.Msg,"info")):$.toptip(b.Msg,3E3,"error")})},getConfig:function(){ha.post({action:"config"}).then(function(a){"ok"==a.code?(reslut=JSON.stringify(a.data[1],null,4),reslut=reslut.replace(/\n/g,"<br/>"),reslut=reslut.replace(/ /g,"&nbsp;"),$.alert(reslut,a.data[0])):$.toptip(a.Msg,3E3,"error")})}}}),ComponentEdit=Vue.extend({template:"#edit",components:{"multi-input":MultiInput},inject:["reload"],data:function(){return{showCustomAction:!1,
customAction:"turn_on turn_off timing_turn_on timing_turn_off increase_brightness decrease_brightness".split(" "),device:{device_id:"",entity_id:[],name:"",zone:"",visable:["aligenie","dueros","jdwhale"],icon:"",type:"",attributes:[],actions:{}},actionKeys:[],isAdd:!0,initDevice:{},isDeviceLoaded:!1,isChange:!1}},mounted:function(){device_id=this.$route.params.device_id;this.initData();"undefined"==typeof device_id||null==device_id||""==device_id?(this.isAdd=!0,$.extend(this.initDevice,this.device)):
(this.isAdd=!1,this.device.device_id=device_id,this.loadDeivce(),$("#device_id").attr("disabled",!0))},watch:{device:{handler:function(a,b){this.isDeviceLoaded&&(this.isChange=!0)},deep:!0}},methods:{updateAction:function(a,b){var c=[],d;for(d in a)c.push(eval("("+a[d].value+")"));this.device.actions[b]=c},delOrReturn:function(a){var b=this;-1==a?this.isChange?$.modal({title:"\u653e\u5f03\u4fdd\u5b58\u8fd4\u56de\u4e3b\u9875\u9762\uff1f",buttons:[{text:"\u786e\u8ba4",onClick:function(){b.$router.push({path:"/"})}},
{text:"\u53d6\u6d88",className:"default"}]}):this.$router.push({path:"/"}):$.modal({title:'\u5373\u5c06\u5220\u9664"'+b.device.device_id+" - "+b.device.name+'"',buttons:[{text:"\u786e\u8ba4",onClick:function(){b.del(a)}},{text:"\u53d6\u6d88",className:"default"}]})},del:function(){var a=this;ha.post({action:"delete",device_id:this.device.device_id}).then(function(b){"ok"==b.code?a.reload():$.toast(b.Msg,"forbidden")});this.$router.push({path:"/"})},loadDeivce:function(){var a=this;ha.post({action:"get",
device_id:a.device.device_id}).then(function(b){"ok"==b.code?(a.device=Object.assign({},a.device,b.data),a.actionKeys=Object.keys(a.device.actions),0<a.actionKeys.filter(function(b){return-1<a.customAction.indexOf(b)}).length?a.showCustomAction=!0:a.showCustomAction=!1):$.toast(b.Msg,"forbidden");$.extend(a.initDevice,a.device);a.$nextTick(function(){a.isDeviceLoaded=!0})})},initData:function(){var a=this;ha.post({action:"getDict",data:["type","action","attribute","platform"]}).then(function(b){if("ok"==
b.code){a.typeData=b.data.type;a.actionData=b.data.action;a.attributeData=b.data.attribute;a.platformData=b.data.platform;b=[];for(var c in a.platformData)b.push({title:c,value:c,annotation:a.platformData[c].cn_name});$("#visable").select({title:"\u9009\u62e9\u53ef\u89c1\u5e73\u53f0\uff1a",multi:!0,split:",",closeText:"\u5b8c\u6210",items:b,onClose:function(b){a.device.visable=b.data.values.split(",")}});b=[];for(c in a.typeData)b.push({title:c,value:c,annotation:a.typeData[c].cn_name});$("#type").select({title:"\u9009\u62e9\u8bbe\u5907\u7c7b\u578b\uff1a",
multi:!1,closeText:"\u5b8c\u6210",items:b,onClose:function(b){a.device.type=b.data.values;$("#switchSyncFromType").is(":checked")&&(a.device.icon=a.typeData[b.data.values].icon)}});b=[];for(c in a.attributeData)b.push({title:c,value:c,annotation:a.attributeData[c].cn_name});$("#attributes").select({title:"\u9009\u62e9\u8bbe\u5907\u5c5e\u6027\uff1a",multi:!0,split:",",closeText:"\u5b8c\u6210",items:b,onClose:function(b){a.device.attributes=b.data.values?b.data.values.split(","):[]}});b=[];for(c in a.actionData)b.push({title:c,
value:c,annotation:a.actionData[c].cn_name});$("#actions").select({title:"\u9009\u62e9actions\uff1a",multi:!0,split:",",closeText:"\u5b8c\u6210",items:b,onClose:function(b){var c=b.data.values.split(","),d=Object.keys(a.device.actions);0<a.customAction.filter(function(a){return-1<c.indexOf(a)}).length?a.showCustomAction=!0:a.showCustomAction=!1;b=c.filter(function(a){return-1==d.indexOf(a)});for(i in b)""!=b[i]&&a.$set(a.device.actions,b[i],[]);b=d.filter(function(a){return-1==c.indexOf(a)});for(i in b)a.$delete(a.device.actions,
b[i]);a.actionKeys=c}})}else $.toast(b.Msg,"forbidden")})},addOrUpdate:function(a){var b=this,c=this;"string"==typeof c.device.entity_id&&(c.device.entity_id=c.device.entity_id.replace(/\s+/g,"").split(","));c.isValid=!0;$(".required").each(function(){if("undefined"==typeof c.device[$(this).text()]||null==c.device[$(this).text()]||""==c.device[$(this).text()])return c.isValid=!1});c.isValid?ha.post({action:"update",device:c.device}).then(function(a){"ok"==a.code?(b.reload(),b.$router.push({path:"/"})):
$.toptip(a.Msg,3E3,"error")}):$.toptip("\u4fe1\u606f\u4e0d\u5b8c\u6574\uff0c\u8bf7\u68c0\u67e5\u5fc5\u586b\u9879","error")}}}),router=new VueRouter({routes:[{path:"/",component:ComponentList},{path:"/edit/:device_id",name:"edit",component:ComponentEdit},{path:"/add",name:"add",component:ComponentEdit}]}),vm=new Vue({el:"#app",router:router,components:{"component-list":ComponentList,"component-edit":ComponentEdit},data:{notice:{title:"Home Assistant Voice Control Service - \u8bbe\u5907\u7ba1\u7406",
noticeList:[]},deviceList:[],isRouterAlive:!0},provide:function(){return{reload:this.reload}},created:function(){this.getNotice();this.getData()},methods:{reload:function(){this.getData()},getData:function(){var a=this;Date.parse(new Date);ha.post({action:"getList"}).then(function(b){"ok"==b.code?a.deviceList=b.data:$.toast(b.Msg,"forbidden")})},getNotice:function(){var a=this;Date.parse(new Date);this.$http.post("https://havcs.ljr.im:8123/account/service.php?v=getClientNotice",{},{emulateJSON:!0}).then(function(b){"ok"==
b.data.code&&(a.notice=b.data.data)},function(a){})}}});$(".hvr-overline-from-center").mouseover(function(){$("#toolbar .toolbar__tip").text($(this).attr("tooltiptext")).css({top:$(this).offset().top-30,left:$(this).offset().left+$(this).width()/2-$("#toolbar .toolbar__tip").width()/2}).show()}).mouseout(function(){$("#toolbar .toolbar__tip").hide()});
